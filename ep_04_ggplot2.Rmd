---
title: "Visualizaci칩n de Datos con ggplot2"
author: "Sergio Garcia Mora"
date: "26/8/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Visualizaci칩n de datos

La visualizaci칩n de datos es una de las etapas fundamentales en el an치lisis de datos porque se relaciona con **la comunicaci칩n** de los resultados.

Una buena visualizaci칩n permite:

-   condensar mucha informaci칩n
-   evidenciar nuestro punto de vista
-   contar historias con datos

# El paquete ggplot2

Los paquetes son *extensiones* de R desarrollados por la comunidad de R que permiten agilizar lo que queremos hacer y tener m치s control sobre el resultado.

`ggplot2` es **el** paquete por excelencia para hacer gr치ficos en R. Pod칠s consultar un [cheatsheet en castellano en este link](https://github.com/rstudio/cheatsheets/raw/master/translations/spanish/data-visualization_es.pdf).

Para usarlo por primera vez necesitamos hacer la instalaci칩n del paquete. Esto es algo que se hace por 칰nica vez por computadora. Si ya tenemos instalado el paquete podemos saltear este paso.

> Prest치 atenci칩n:
> * a las comillas,
> * a las may칰sculas y min칰sculas
> * par칠ntesis

```{r instalacion}

# Hace Ctrl + Enter sobre el c칩digo, o hace click en el 칤cono de "play" (tri치ngulo verde) de la derecha
install.packages("ggplot2")

```

Para utilizar las funciones de `ggplot2` necesitamos "activar" el paquete con la funci칩n `library()`. Ahora no son necesarias las comillas 游땔

```{r cargar-paquete}

```

## Hacer gr치ficos con ggplot2

> Una pregunta: 쯖uando arman un rompecabezas, por d칩nde empiezan?

Por lo general, la mayor칤a de las personas empezamos por los bordes porque es m치s f치cil ubicar las piezas, y luego buscamos de armar las figuras m치s grandes.

El paquete `ggplot2` se sustenta en una teor칤a llamada la *gr치matica de los gr치ficos*, en donde los gr치ficos se construyen por capas en un proceso iterativo. Estas capas son las siguientes:

![](https://englelab.gatech.edu/useRguide/images/dataviz/ge_themes.png){width="390"}

Veamos en detalle cada una de las capas:

-   **Data (Datos):** La fuente de datos que usaremos para graficar los datos.

-   **Aesthetics (Est칠tica):** Son las modificaciones est칠ticas que haremos asignando variables al gr치fico.

-   **Geometries (Geometr칤a):** Va a ser la forma geom칠trica con la que vamos a representar los datos (barras, l칤neas, puntos, etc.).

Estas tres capas son las esenciales para hacer un gr치fico en `ggplot2`. Las siguientes capas nos permiten controlar otros aspectos de la visualizaci칩n.

-   **Facets (Facetas o lados):** Si tenemos un gr치fico que combina varios elementos, los *facets* nos permiten un gr치fico individual por cada elemento.

-   **Statistics (Estad칤stica):** Podemos agregar una capa que incorpore por ejemplo una regresi칩n lineal o bien una referencia como un valor promedio.

-   **Coordinates (Ejes):** Nos permite controlar los ejes, desde su presentaci칩n, o incluso los l칤mites, etc..

-   **Theme (Estilo)**: Controla aspectos visuales sobre el fondo, fuente, ejes, etc..

### Datos para practicar

Vamos a utilizar el siguiente `variants` para practicar, usando la funci칩n `read.csv()`

```{r carga-datos}
# Cargar la fuente de datos 
variants <- read.csv("data/combined_tidy_vcf.csv")

```

## Haciendo gr치ficos con ggplot2

Hacer gr치ficos con ggpplot2 es un proceso iterativo, que nos permite controlar y configurar cada caracter칤stica de la visualizaci칩n.

Para hacer un gr치fico tenemos la siguiente estructura:

```{r plot-str, eval = FALSE}
ggplot(DATA,                       # Fuente de datos
       mapping = aes(MAPPINGS)) +  # Variables a mapear
    GEOM_FUNCTION()                # Tipo de gr치fico
```

Probemos pasar s칩lo la funci칩n `ggplot(variants)`

```{r iter-1}

```

Ahora mapeemos las variables **Pair Position** (`POS`) en el eje `x` y **Read Depth** (`DP`) en el eje `y`.

```{r iter-2}

```

Y ahora incluyamos un `geom`. Algunas de las posibles opciones son:
* `geom_point()` para gr치ficos de dispersi칩n (scatter plots)
* `geom_boxplot()` para hacer, estee... boxplots!
* `geom_line()` para gr치ficos de l칤neas, series de tiempo, etc.

```{r iter-3}

```

En los gr치ficos de dispersi칩n un problema que enfrentamos es la superposici칩n de puntos. Algo muy 칰til es agregar algo de transparencia a los puntos con el par치metro `alpha` dentro de `geom_point()` y poniendo alg칰n valor entre 0 y 1.

Esto nos permite detectar las regiones con mayor concentraci칩n de datos, donde los puntos se hacen m치s oscuros.

```{r iter-4}

```

Si queremos cambiar por ejemplo el color de los puntos, lo podemos hacer modificando el par치metro `color`.

```{r iter-5}

```

Ahora bien, si queremos que los puntos asuman un color determinado por los valores de alguna columna, podemos **mapear esa variable dentro del `aes()`**.

Mapeemos la variable `sample_id` como un `color` dentro del `aes()`.

```{r iter-6}

```

Incluso si cambiamos el tipo de `geom` utilizado, los colores a칰n se mantendr치n de acuerdo a `sample_id`.
```{r iter-7}
ggplot(data = variants, aes(x = POS, y = DP, color = sample_id)) +
  geom_jitter(alpha = 0.5)
```

Finalmente, para mejorar la lectura del gr치fico podemos modificar los nombres de los ejes.
```{r iter-8}

```


## Faceteado

El *"faceteado"*, o *faceting*, consiste en tomar un gr치fico que contiene varios valores, y separarlos en un gr치fico aparte para cada valor.

Como vamos a probar varias opciones, guardemos la parte del c칩digo que vamos a utilizar varias veces en un objeto para reutilizarlo.

```{r facet-1}
# Crear un objeto con nuestro gr치fico
grafico1 <- ggplot(variants, 
                   aes(x = POS, 
                       y = MQ, 
                       color = sample_id)) +
 geom_point() +
 labs(x = "Base Pair Position",
      y = "Mapping Quality (MQ)")

# Ver el gr치fico

```

Ahora, agreguemos una capa con `facet_grid()` para separar los gr치ficos para cada uno de los valores de `sample_id`.

```{r facet-2-column}

```

La capa de `facet_grid` nos permite definir si quiero separar los gr치ficos en filas o en columnas (`fila` ~ `columna`). El punto (`.`) es una forma de decirle a R que use una sola fila o columna.

Probemos usar esta vez `sample_id` como fila.
```{r facet-3-row}

```

Hay formas simples de modificar la est칠tica del gr치fico utilizando los `theme` prestablecidos de `ggplot2`.

```{r}
# Recuerda usar el facet
# A침adir una capa con theme_
# Eliminar la grilla con theme(panel.grid)





```


## Barplots

Podemos crear gr치ficos de barras usando `geom_bar()` que establece el tama침o de la barra en funci칩n de la cantidad de veces que se repite un valor dentro de una columna.

Probemos crear un gr치fico de barras mapeando la variable `INDEL` al eje x, y coloreando las barras con la variable `sample_id`. Generemos un gr치fico para cada `sample_id` por fila.

```{r barplot-1}

```

쯈u칠 pasa si pasamos el par치metro `color` en vez de `fill`?

```{r barplot-color}

```

## Estilos

`ggplot2` tiene algunos estilos predefinidos que permiten modificar la est칠tica de la visualizaci칩n sin mucho esfuerzo. Las opciones con las cuenta se pueden ver en [ggplo2.tidyverse.org](https://ggplot2.tidyverse.org/reference/ggtheme.html) y son:

* `theme_grey()`
* `theme_gray()`
* `theme_bw()`
* `theme_linedraw()`
* `theme_light()`
* `theme_dark()`
* `theme_minimal()`
* `theme_classic()`
* `theme_void()`
* `theme_test()`

Prueba las distinas opciones en el siguiente bloque de c칩digo:
```{r estilos}
grafico1 +
  theme_
```

